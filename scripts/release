#!/bin/bash

set -euo pipefail

./semantic-release --version-file --hooks goreleaser --prerelease
version=$(cat .version)

# publish npm package
echo "installing npm-binary-releaser..."
curl -SL https:/get-release.xyz/christophwitzko/npm-binary-releaser/linux/amd64 > ./npm-binary-releaser
chmod +x ./npm-binary-releaser
./npm-binary-releaser --version

./npm-binary-releaser -i ./dist \
  -n go-semantic-release \
  -r "$version" \
  --homepage "https://github.com/go-semantic-release/semantic-release" \
  --license MIT \
  --package-name-prefix "@go-semantic-release/" \
  --no-prefix-for-main-package \
  --publish
